# Pac-Man

é€™æ˜¯ä¸€å€‹åŸºæ–¼ Pygame çš„ Pac-Man éŠæˆ²å¯¦ç¾ï¼Œæ¡ç”¨ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆï¼ˆOOPï¼‰åŸå‰‡ï¼Œçµåˆæ·±åº¦ Q å­¸ç¿’ï¼ˆDQNï¼‰èˆ‡è¦å‰‡åŸºç¤ AI æ§åˆ¶ç­–ç•¥ã€‚å°ˆæ¡ˆæ”¯æ´éš¨æ©Ÿè¿·å®®ç”Ÿæˆã€å¤šæ¨£åŒ–çš„é¬¼é­‚è¡Œç‚ºã€ç©å®¶æ§åˆ¶èˆ‡ AI è‡ªå‹•æ§åˆ¶ï¼Œä¸¦æä¾› DQN ä»£ç†è¨“ç·´èˆ‡è¨“ç·´çµæœå¯è¦–åŒ–å·¥å…·ã€‚OOP çš„æ‡‰ç”¨ç¢ºä¿äº†ç¨‹å¼ç¢¼çš„æ¨¡çµ„åŒ–ã€å¯ç¶­è­·æ€§å’Œå¯æ“´å±•æ€§ï¼Œé€éé¡åˆ¥è¨­è¨ˆå¯¦ç¾äº†éŠæˆ²é‚è¼¯çš„æ¸…æ™°åˆ†å±¤ã€‚

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

ä»¥ä¸‹æ˜¯å°ˆæ¡ˆçš„ç›®éŒ„çµæ§‹èˆ‡ä¸»è¦æ¨¡çµ„èªªæ˜ï¼š

```
oop-2025-proj-pacman/
â”œâ”€â”€ main.py                 # éŠæˆ²ä¸»ç¨‹å¼ï¼Œè² è²¬åˆå§‹åŒ–èˆ‡é‹è¡ŒéŠæˆ²
â”œâ”€â”€ config.py               # éŠæˆ²å¸¸é‡èˆ‡é…ç½®ï¼ˆè¿·å®®å°ºå¯¸ã€é¡è‰²ç­‰ï¼‰
â”œâ”€â”€ scores.json             # å„²å­˜éŠæˆ²åˆ†æ•¸
â”œâ”€â”€ .gitattributes          # Git å±¬æ€§é…ç½®
â”œâ”€â”€ .gitignore              # Git å¿½ç•¥æª”æ¡ˆ
â”œâ”€â”€ ai/                     # AI èˆ‡ DQN ç›¸é—œæ¨¡çµ„
â”‚   â”œâ”€â”€ agent.py           # DQN ä»£ç†ï¼Œç®¡ç†è¨˜æ†¶ç·©è¡èˆ‡è¨“ç·´é‚è¼¯
â”‚   â”œâ”€â”€ dqn.py             # DQN ç¥ç¶“ç¶²è·¯æ¨¡å‹å®šç¾©
â”‚   â”œâ”€â”€ environment.py     # RL ç’°å¢ƒ
â”‚   â”œâ”€â”€ plot_metrics.py    # ç¹ªè£½è¨“ç·´çå‹µèˆ‡æå¤±åœ–è¡¨ï¼Œè¼¸å‡ºç‚º PNG
â”‚   â”œâ”€â”€ sumtree.py         # å„ªå…ˆç¶“é©—å›æ”¾çš„ SumTree çµæ§‹
â”‚   â”œâ”€â”€ test_cuda.py       # æª¢æŸ¥ CUDA å¯ç”¨æ€§çš„å·¥å…·è…³æœ¬
â”‚   â”œâ”€â”€ train.py           # DQN è¨“ç·´è¿´åœˆï¼Œæ”¯æ´ TensorBoard è¨˜éŒ„
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ __pycache__/
â”œâ”€â”€ game/                   # éŠæˆ²é‚è¼¯èˆ‡ç’°å¢ƒæ¨¡çµ„
â”‚   â”œâ”€â”€ game.py            # æ ¸å¿ƒéŠæˆ²é‚è¼¯ï¼Œç®¡ç†ç‹€æ…‹æ›´æ–°èˆ‡ç¢°æ’æª¢æ¸¬
â”‚   â”œâ”€â”€ maze_generator.py  # éš¨æ©Ÿè¿·å®®ç”Ÿæˆå™¨ï¼ŒåŒ…å«ç‰†å£èˆ‡è·¯å¾‘
â”‚   â”œâ”€â”€ menu.py            # éŠæˆ²é¸å–®
â”‚   â”œâ”€â”€ renderer.py        # ä½¿ç”¨ Pygame æ¸²æŸ“éŠæˆ²ç•«é¢
â”‚   â”œâ”€â”€ strategies.py      # æ§åˆ¶ç­–ç•¥ï¼ˆç©å®¶ã€è¦å‰‡ AIã€DQN AIï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ entities/          # éŠæˆ²å¯¦é«”å®šç¾©
â”‚   â”‚   â”œâ”€â”€ entity_base.py # å¯¦é«”åŸºé¡
â”‚   â”‚   â”œâ”€â”€ entity_initializer.py # åˆå§‹åŒ–éŠæˆ²å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ ghost.py       # é¬¼é­‚å¯¦é«”ï¼ŒåŒ…å«è¦å‰‡åŸºç¤è¡Œç‚º
â”‚   â”‚   â”œâ”€â”€ pacman.py      # Pac-Man å¯¦é«”ï¼ŒåŒ…å«ç§»å‹•é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ pellets.py     # åˆ†æ•¸çƒèˆ‡èƒ½é‡çƒ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ __pycache__/
â”‚   â””â”€â”€ __pycache__/
â”œâ”€â”€ docx/                   # æ–‡ä»¶è³‡æ–™å¤¾
â”‚   â”œâ”€â”€ classdiagram.md    # é¡åˆ¥åœ–ï¼Œæè¿°ç‰©ä»¶é—œä¿‚
â”‚   â”œâ”€â”€ requirements.txt   # Python ä¾è³´æ¸…å–®
â”œâ”€â”€ runs/                   # TensorBoard è¨“ç·´è¨˜éŒ„
â”œâ”€â”€ members/
â”‚   â”œâ”€â”€ 113511002.txt
â”‚   â”œâ”€â”€ 113511034.txt
â”‚   â”œâ”€â”€ 113511264.txt
â””â”€â”€ __pycache__/
```

### **é…ç½®èˆ‡æ–‡ä»¶**
- **`config.py`**ï¼šå®šç¾©å¸¸é‡ï¼ˆå¦‚ `MAZE_WIDTH`ã€`CELL_SIZE`ï¼‰ï¼Œä½œç‚ºå…¨å±€é…ç½®ï¼Œæ¸›å°‘ç¡¬ç·¨ç¢¼ã€‚
- **`docx/classdiagram.md`**ï¼šä½¿ç”¨ Mermaid æè¿°é¡åˆ¥é—œä¿‚ï¼Œå±•ç¤º OOP çµæ§‹ã€‚
- **`docx/requirements.txt`**ï¼šåˆ—å‡ºä¾è³´ï¼Œç¢ºä¿ç’°å¢ƒä¸€è‡´æ€§ã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### **ç’°å¢ƒè¦æ±‚**
- Python 3.13.2ï¼ˆæˆ– 3.8 ä»¥ä¸Šï¼‰
- Pygame 2.6.1
- PyTorchï¼ˆè«‹æ ¹æ“š GPU (CUDA) é¸æ“‡ç‰ˆæœ¬ï¼‰
- NumPy
- Matplotlib
- TensorBoard
- Optuna

å®‰è£ä¾è³´ï¼š
```bash
pip install -r docx/requirements.txt
```

æˆ–æ‰‹å‹•å®‰è£ï¼š
```bash
pip install pygame torch numpy matplotlib tensorboard optuna
```

### **é‹è¡ŒéŠæˆ²**
å•Ÿå‹•éŠæˆ²ï¼š
```bash
python main.py
```

- **æ§åˆ¶æ–¹å¼**ï¼š
  - æ–¹å‘éµï¼ˆâ†‘â†“â†â†’ï¼‰ï¼šæ§åˆ¶ Pac-Man ç§»å‹•ã€‚
  - ESCï¼šæš«åœéŠæˆ²ã€‚

### è¨“ç·´ DQN ä»£ç†

åŸ·è¡Œ `train.py` ä»¥è¨“ç·´ Pac-Man DQN ä»£ç†ï¼Œæ”¯æ´æ¨¡ä»¿å­¸ç¿’é è¨“ç·´ã€æ··åˆç²¾åº¦è¨“ç·´ï¼ˆAMPï¼‰å’Œæ—©æœŸåœæ­¢æ©Ÿåˆ¶ã€‚

#### åŸ·è¡Œå‘½ä»¤
```bash
python .\ai\train.py 
python .\ai\train.py --resume
python .\ai\train.py --optuna
python .\ai\train.py --lr=0.0002508174045981659 --batch_size=32 --target_update_freq=16 --sigma=1.729094637096922 --n_step=4 --gamma=0.9692851354067678 --alpha=0.7348860970883 --beta=0.486157045831763 --beta_increment=0.002912893141237 --expert_prob_start=0.21334503709248 --expert_prob_end=0.02939906261627297 --expert_prob_decay_steps=913713 --expert_random_prob=0.1258641892374785 --max_expert_data=14188 --ghost_penalty_weight=3.44364709228557
```

## é¸é …

### é€šç”¨é¸é …
- **`--resume`**ï¼ˆå¸ƒæ—å€¼ï¼Œé è¨­ï¼š`False`ï¼‰  
  å¾å…ˆå‰ä¿å­˜çš„æ¨¡å‹å’Œå›æ”¾ç·©è¡å€ç¹¼çºŒè¨“ç·´ã€‚  
  - ä½¿ç”¨ `--model_path` å’Œ `--memory_path` æŒ‡å®šçš„è·¯å¾‘ã€‚
- **`--optuna`**ï¼ˆå¸ƒæ—å€¼ï¼Œé è¨­ï¼š`False`ï¼‰  
  å•Ÿç”¨ Optuna é€²è¡Œè¶…åƒæ•¸å„ªåŒ–ï¼Œè‡ªå‹•æœç´¢æœ€ä½³åƒæ•¸çµ„åˆã€‚  
  - åŸ·è¡Œ 50 æ¬¡è©¦é©—ï¼Œå„²å­˜çµæœæ–¼ `sqlite:///optuna.db`ã€‚

### è¨“ç·´è¨­ç½®
- **`--episodes`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`1000`ï¼‰  
  ç¸½è¨“ç·´å›åˆæ•¸ã€‚
- **`--pretrain_episodes`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`100`ï¼‰  
  é è¨“ç·´æ™‚æ”¶é›†å°ˆå®¶æ•¸æ“šçš„å›åˆæ•¸ã€‚
- **`--early_stop_reward`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`10000`ï¼‰  
  ç•¶æœ€è¿‘ 100 å›åˆå¹³å‡çå‹µé”åˆ°æ­¤é–¾å€¼æ™‚ï¼Œæå‰åœæ­¢è¨“ç·´ã€‚
- **`--model_path`**ï¼ˆå­—ä¸²ï¼Œé è¨­ï¼š`"pacman_dqn.pth"`ï¼‰  
  æ¨¡å‹ä¿å­˜/è¼‰å…¥çš„æª”æ¡ˆè·¯å¾‘ã€‚
- **`--memory_path`**ï¼ˆå­—ä¸²ï¼Œé è¨­ï¼š`"replay_buffer.pkl"`ï¼‰  
  å›æ”¾ç·©è¡å€ä¿å­˜/è¼‰å…¥çš„æª”æ¡ˆè·¯å¾‘ã€‚

### DQN æ¨¡å‹åƒæ•¸
- **`--lr`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.001`ï¼‰  
  å­¸ç¿’ç‡ï¼Œæ§åˆ¶æ¨¡å‹åƒæ•¸æ›´æ–°çš„æ­¥é•·ã€‚
- **`--batch_size`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`128`ï¼‰  
  æ¯æ¬¡è¨“ç·´çš„æ‰¹é‡å¤§å°ã€‚
- **`--target_update_freq`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`10`ï¼‰  
  ç›®æ¨™ç¶²çµ¡æ›´æ–°çš„å›åˆé »ç‡ã€‚
- **`--sigma`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.3`ï¼‰  
  Noisy DQN å±¤çš„å™ªè²å› å­ï¼Œç”¨æ–¼æ¢ç´¢ã€‚
- **`--n_step`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`8`ï¼‰  
  n æ­¥å›å ±çš„æ­¥æ•¸ï¼Œå½±éŸ¿é•·æœŸçå‹µè¨ˆç®—ã€‚
- **`--gamma`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.95`ï¼‰  
  æŠ˜æ‰£å› å­ï¼Œæ§åˆ¶æœªä¾†çå‹µçš„æ¬Šé‡ã€‚
- **`--alpha`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.8`ï¼‰  
  å„ªå…ˆç´šç¶“é©—å›æ”¾çš„ alpha åƒæ•¸ï¼Œæ§åˆ¶æ¡æ¨£å„ªå…ˆç´šã€‚
- **`--beta`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.6`ï¼‰  
  å„ªå…ˆç´šç¶“é©—å›æ”¾çš„ beta åƒæ•¸ï¼Œæ§åˆ¶é‡è¦æ€§æ¡æ¨£æ¬Šé‡ã€‚
- **`--beta_increment`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.0001`ï¼‰  
  æ¯æ­¥è¨“ç·´çš„ beta å¢é‡ã€‚
- **`--expert_prob_start`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.3`ï¼‰  
  å°ˆå®¶è¡Œå‹•ç­–ç•¥çš„åˆå§‹æ¦‚ç‡ã€‚
- **`--expert_prob_end`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.01`ï¼‰  
  å°ˆå®¶è¡Œå‹•ç­–ç•¥çš„çµæŸæ¦‚ç‡ã€‚
- **`--expert_prob_decay_steps`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`500000`ï¼‰  
  å°ˆå®¶æ¦‚ç‡å¾èµ·å§‹åˆ°çµæŸçš„è¡°æ¸›æ­¥æ•¸ã€‚
- **`--ghost_penalty_weight`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`3.0`ï¼‰  
  é è¿‘é¬¼é­‚æ™‚çš„æ‡²ç½°æ¬Šé‡ï¼Œå½±éŸ¿çå‹µè¨ˆç®—ã€‚

### å°ˆå®¶æ•¸æ“šæ”¶é›†åƒæ•¸
- **`--expert_episodes`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`100`ï¼‰  
  æ”¶é›†å°ˆå®¶æ•¸æ“šçš„å›åˆæ•¸ã€‚
- **`--expert_max_steps_per_episode`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`200`ï¼‰  
  æ¯å€‹å°ˆå®¶å›åˆçš„æœ€å¤§æ­¥æ•¸ã€‚
- **`--expert_random_prob`**ï¼ˆæµ®é»æ•¸ï¼Œé è¨­ï¼š`0.1`ï¼‰  
  å°ˆå®¶æ•¸æ“šæ”¶é›†æ™‚éš¨æ©Ÿè¡Œå‹•çš„æ¦‚ç‡ã€‚
- **`--max_expert_data`**ï¼ˆæ•´æ•¸ï¼Œé è¨­ï¼š`10000`ï¼‰  
  æ”¶é›†çš„æœ€å¤§å°ˆå®¶æ•¸æ“šé‡ã€‚
  
#### è¼¸å‡º

- **TensorBoard è¨˜éŒ„**ï¼šå„²å­˜æ–¼ `runs/`ï¼ŒåŒ…å«ä»¥ä¸‹æŒ‡æ¨™ï¼š
  - `Reward`ï¼šæ¯å›åˆç¸½çå‹µã€‚
  - `Mean_Q_Value`ï¼šå¹³å‡ Q å€¼ã€‚
  - `Loss`ï¼šè¨“ç·´æå¤±ã€‚
  - `Lives_Lost`ï¼šæ¯å›åˆç”Ÿå‘½æå¤±æ¬¡æ•¸ã€‚
  - `Action_i_Ratio`ï¼šå‹•ä½œåˆ†ä½ˆæ¯”ä¾‹ï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³ï¼‰ã€‚
  - `Expert_Probability`ï¼šç•¶å‰å°ˆå®¶æ¦‚ç‡ã€‚
  - NoisyLinear å™ªè²æŒ‡æ¨™ï¼ˆä¾‹å¦‚ `FC1_Weight_Sigma_Mean`ï¼‰ã€‚
- **æ¨¡å‹èˆ‡è¨˜æ†¶ç·©è¡**ï¼šå„²å­˜ç‚º `pacman_dqn_final.pth` å’Œ `replay_buffer_final.pkl`ã€‚
- **å›åˆæ•¸æ“š**ï¼šæ¯å›åˆçš„çå‹µå„²å­˜æ–¼ `episode_rewards.json`ï¼Œç”Ÿå‘½æå¤±å„²å­˜æ–¼ `episode_lives_lost.json`ã€‚


### **å¯è¦–åŒ–è¨“ç·´çµæœ**
ç”Ÿæˆè¨“ç·´åœ–è¡¨ï¼š
```bash
python ai/plot_metrics.py
```

- å°‡çå‹µèˆ‡æå¤±æ›²ç·šå„²å­˜ç‚º `training_metrics.png`ã€‚

åœ¨tensorboardä¸­æŸ¥çœ‹(å¯ç”¨æ–¼è¨“ç·´ä¸­)
```bash
tensorboard --logdir runs
```

### **æª¢æŸ¥ CUDA ç’°å¢ƒ**
```bash
python ai/test_cuda.py
```

## ğŸ› å·²çŸ¥å•é¡Œ
- **DQN AI** : æœƒä¸»å‹•å°‹æ‰¾èƒ½é‡çƒï¼Œå°æ©Ÿç‡åƒé¬¼ï¼Œä½†èº²é¿é¬¼é­‚çš„èƒ½åŠ›ä¸è¶³ã€‚
- **é è¨ˆæ”¹é€²**ï¼š
  - æ·»åŠ å‹•ç•«æ•ˆæœï¼Œæ”¹å–„è¦–è¦ºé«”é©—ã€‚
  - å„ªåŒ– PacmanEnv çš„çå‹µæ©Ÿåˆ¶ã€‚(åŠ å¼·èº²é¬¼ç­–ç•¥è©¦é©—ä¸­)

## ğŸ’¡ ä½œè€…
ç”± Group 6 é–‹ç™¼ï¼Œæ„Ÿè¬ `members/` ä¸­åˆ—å‡ºçš„è²¢ç»è€…ã€‚

## åƒè€ƒæ–‡ç»
- [Optuna: A Next-generation Hyperparameter Optimization Framework](https://dl.acm.org/doi/10.1145/3292500.3330701)
    - è¶…åƒæ•¸å„ªåŒ–å™¨ 
- [Pac-Man Maze Generation](https://shaunlebron.github.io/pacman-mazegen/)
    - è¿·å®®ç”Ÿæˆè¨­è¨ˆéˆæ„Ÿä¾†æº
- [Human-level control through deep reinforcement learning](https://www.nature.com/articles/nature14236?wm=book_wap_0005)
    - åŸºç¤ DQN æ¶æ§‹
- [Noisy Networks for Exploration](https://arxiv.org/abs/1706.10295)
    - åŠ å¼·DQN
- [Dueling Network Architectures for Deep Reinforcement Learning](https://arxiv.org/abs/1511.06581)
    - åŠ å¼·DQN
- [Rainbow: Combining Improvements in Deep Reinforcement Learning](https://arxiv.org/abs/1710.02298)
    - åŠ å¼·DQN
- [PyTorch Offical Website](https://pytorch.org/)
    - è¨“ç·´DQN
- [PyTorch: An imperative style, high-performance deep learning library](https://arxiv.org/abs/1912.01703)
    - è¨“ç·´DQN
- [OpenAI Gym](https://github.com/openai/gym)
    - ç’°å¢ƒå»ºæ§‹éˆæ„Ÿä¾†æº
- [Mastering the game of Go with deep neural networks and tree search](https://www.nature.com/articles/nature16961)
    - æ¨¡ä»¿å­¸ç¿’çµåˆå¼·åŒ–å­¸ç¿’çš„éˆæ„Ÿä¾†æº

